---
title: "simple_bayes_modelling"
author: "Martine Lind Jensen"
date: "2024-04-12"
output: html_document
---
```{r}
pacman::p_load(cmdstanr, tidyverse, LaplacesDemon)
```


This needs to be done! 
```{r}
#Create function to simulate data 

sim_simple_f <- function()

#Simulate some data 

bias <- 0
trials <- seq(10)
Source1 <- seq(1,8, 1)
Source2 <- seq(1,8, 1)

db <- expand.grid(bias = bias, trials = trials, Source1 = Source1, Source2 = Source2)

for (n in seq(nrow(db))) {
  db$belief[n] <- SimpleBayes_f(db$bias[n], db$Source1[n], db$Source2[n])
  db$choice[n] <- rbinom(1,1, db$belief[n])
  db$continuous[n] <- db$belief[n]*9
  db$discrete[n] <- round(db$belief[n]*9,0)
}

```

```{r}
file <- file.path("simple_sc.stan")

model_simple <- cmdstan_model(file, cpp_options = list(stan_threads = TRUE),
                     stanc_options = list("O1"))
```

```{r}
#remove na's in data 

df <- read_csv("data/data.csv")

df <- na.omit(df)

data <- list(
  N = 2598, 
  SecondRating = df$SecondRating, 
  FirstRating = df$FirstRating, 
  GroupRating = df$GroupRating
)
```

```{r}
samples_simple_sc <- model_simple$sample(
  data = data,
  #fixed_param = TRUE,
  seed = 123,
  chains = 2,
  parallel_chains = 2,
  threads_per_chain = 2,
  iter_warmup = 1500,
  iter_sampling = 3000,
  refresh = 500
)

samples_simple_sc$save_object("models/simple_sc.rds")
```

```{r}
samples_simple_sc <- readRDS("models/simple_sc.rds")

samples_simple_sc$cmdstan_diagnose() #function checking the chains and stuff

samples_simple_sc$summary() # summarize the model

```

```{r}
samples_simple_sc$loo()
```

```{r}
# Extract posterior samples and include sampling of the prior:
simple_draws_df <- as_draws_df(samples_simple_sc$draws())
```

Model checking and plotting
- chains 
- priors
```{r}

```

Weighted model
```{r}

```

Model comparison 

```{r}

```

